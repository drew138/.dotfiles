---
- name: Read InitialKeyRepeat value
  ansible.builtin.command: defaults read -g InitialKeyRepeat
  register: keyboard_verify_initial_key_repeat
  changed_when: false
  failed_when: false

- name: Read KeyRepeat value
  ansible.builtin.command: defaults read -g KeyRepeat
  register: keyboard_verify_key_repeat
  changed_when: false
  failed_when: false

- name: Assert InitialKeyRepeat is set correctly
  ansible.builtin.assert:
    that:
      - keyboard_verify_initial_key_repeat.rc == 0
      - keyboard_verify_initial_key_repeat.stdout | int == 15
    fail_msg: >
      InitialKeyRepeat is not set correctly.
      Expected 15, got {{ keyboard_verify_initial_key_repeat.stdout }}

- name: Assert KeyRepeat is set correctly
  ansible.builtin.assert:
    that:
      - keyboard_verify_key_repeat.rc == 0
      - keyboard_verify_key_repeat.stdout | int == 2
    fail_msg: >
      KeyRepeat is not set correctly.
      Expected 2, got {{ keyboard_verify_key_repeat.stdout }}
