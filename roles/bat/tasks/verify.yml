---
- name: Locate bat binary
  ansible.builtin.command: which bat
  register: bat_verify_which
  changed_when: false
  failed_when: false

- name: Check if bat binary exists
  ansible.builtin.stat:
    path: "{{ bat_verify_which.stdout }}"
  register: bat_verify_bin
  when: bat_verify_which.rc == 0

- name: Assert bat binary is present and executable
  ansible.builtin.assert:
    that:
      - bat_verify_bin.stat is defined
      - bat_verify_bin.stat.exists
      - bat_verify_bin.stat.executable
    fail_msg: "bat binary was not found in the PATH or is not executable."

- name: List bat themes
  ansible.builtin.command: bat --list-themes
  register: bat_verify_themes
  changed_when: false
  failed_when: false
  environment:
    PATH: "/opt/homebrew/bin:/usr/local/bin:{{ ansible_facts.env.PATH }}"

- name: Assert nightfox theme is installed
  ansible.builtin.assert:
    that:
      - bat_verify_themes.rc == 0
      - "'nightfox' in bat_verify_themes.stdout"
    fail_msg: "bat theme 'nightfox' was not found in `bat --list-themes` output."
