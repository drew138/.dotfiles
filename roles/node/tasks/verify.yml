---
- name: verify node runs when nvm is sourced
  shell: |
    source "{{ ansible_facts.env.HOME }}/.nvm/nvm.sh"
    node --version
  args:
    executable: /bin/bash
  register: verify_node_version
  changed_when: false
  failed_when: false

- name: assert node is available via nvm
  assert:
    that:
      - verify_node_version.rc == 0
      - verify_node_version.stdout is match("^v[0-9]+\\.")
    fail_msg: >
      Node is not available after sourcing nvm.
      Output: {{ verify_node_version.stdout }}
