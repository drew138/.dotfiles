---
- name: Verify node runs when nvm is sourced
  ansible.builtin.shell: |
    source "{{ ansible_facts['env']['HOME'] }}/.nvm/nvm.sh"
    node --version
  args:
    executable: /bin/bash
  register: node_verify_version
  changed_when: false
  failed_when: false

- name: Assert node is available via nvm
  ansible.builtin.assert:
    that:
      - node_verify_version.rc == 0
      - node_verify_version.stdout is match("^v[0-9]+\\.")
    fail_msg: >
      Node is not available after sourcing nvm.
      Output: {{ node_verify_version.stdout }}
