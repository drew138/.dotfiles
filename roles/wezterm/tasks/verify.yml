---
- name: check wezterm application stats
  stat:
    path: /Applications/WezTerm.app
  register: wezterm_app_stat

- name: assert wezterm application is installed
  assert:
    that:
      - wezterm_app_stat.stat.exists
      - wezterm_app_stat.stat.isdir
    fail_msg: "WezTerm.app was not found in /Applications"

- name: check .wezterm.lua symlink stats
  stat:
    path: "{{ ansible_facts.env.HOME }}/.wezterm.lua"
  register: wezterm_config_stat

- name: assert wezterm config symlink is valid
  assert:
    that:
      - wezterm_config_stat.stat.exists
      - wezterm_config_stat.stat.islnk
      - wezterm_config_stat.stat.lnk_source == ansible_facts.env.HOME + "/.dotfiles/roles/wezterm/files/.wezterm.lua"
    fail_msg: "WezTerm symlink is missing, broken, or pointing to the wrong source"

- name: locate wezterm-gui binary
  command: which wezterm
  register: wezterm_cli_which
  changed_when: false
  failed_when: false

- name: assert wezterm cli is accessible
  assert:
    that:
      - wezterm_cli_which.rc == 0
    fail_msg: "The 'wezterm' CLI binary is not in the PATH"
