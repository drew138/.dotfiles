---
- name: clone fzf repo
  become: true
  become_user: "{{ ansible_facts.env.USER }}"
  git:
    repo: "https://github.com/junegunn/fzf.git"
    dest: "{{ ansible_facts.env.HOME }}/.fzf"
    depth: 1
    version: HEAD
    clone: true
    update: true

- name: install fzf
  become: true
  become_user: "{{ ansible_facts.env.USER }}"
  command: "{{ ansible_facts.env.HOME }}/.fzf/install --no-bash --no-fish --key-bindings --completion --no-update-rc"
  args:
    creates: "{{ ansible_facts.env.HOME }}/.fzf.zsh"

    # TODO: remove
- name: check fzf repo status
  become: true
  become_user: "{{ ansible_facts.env.USER }}"
  command: git status --porcelain
  args:
    chdir: "{{ ansible_facts.env.HOME }}/.fzf"
  register: fzf_git_status
  changed_when: false
  failed_when: false

- name: debug fzf git status
  debug:
    msg: |
      fzf git status:
      {{ fzf_git_status.stdout | default('(clean)') }}
