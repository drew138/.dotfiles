---
- name: Locate packer binary
  ansible.builtin.command: which packer
  register: packer_verify_which
  changed_when: false
  failed_when: false

- name: Check if packer binary exists
  ansible.builtin.stat:
    path: "{{ packer_verify_which.stdout }}"
  register: packer_verify_bin
  when: packer_verify_which.rc == 0

- name: Assert packer binary is present and executable
  ansible.builtin.assert:
    that:
      - packer_verify_bin.stat is defined
      - packer_verify_bin.stat.exists
      - packer_verify_bin.stat.executable
    fail_msg: "packer binary was not found in the PATH or is not executable"
