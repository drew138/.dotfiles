---
- name: Read current desktop wallpaper via System Events
  ansible.builtin.command: >
    osascript -e 'tell application "System Events" to get picture of desktop 1'
  register: wallpaper_verify_system_events
  changed_when: false
  failed_when: wallpaper_verify_system_events.rc != 0

- name: Normalize wallpaper path
  ansible.builtin.set_fact:
    wallpaper_current_path: "{{ wallpaper_verify_system_events.stdout | trim }}"
  changed_when: false

- name: Fail if wallpaper path could not be detected
  ansible.builtin.fail:
    msg: "Could not detect current wallpaper via System Events"
  when:
    - wallpaper_current_path is not defined
      or wallpaper_current_path == ""

- name: Verify wallpaper path matches expected
  ansible.builtin.assert:
    that:
      - wallpaper_current_path == wallpaper_path
    fail_msg: >
      wallpaper_verify failed.
      Expected: {{ wallpaper_path }}
      Got: {{ wallpaper_current_path }}
    success_msg: "wallpaper_verify succeeded: wallpaper matches System Events"
