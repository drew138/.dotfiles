---
- name: read current desktop wallpaper via System Events
  command: >
    osascript -e 'tell application "System Events" to get picture of desktop 1'
  register: verify_wallpaper_system_events
  changed_when: false
  failed_when: verify_wallpaper_system_events.rc != 0

- name: normalize wallpaper path
  set_fact:
    verify_wallpaper_current_path: "{{ verify_wallpaper_system_events.stdout | trim }}"
  changed_when: false

- name: fail if wallpaper path could not be detected
  fail:
    msg: "verify_wallpaper: Could not detect current wallpaper via System Events"
  when:
    - verify_wallpaper_current_path is not defined
      or verify_wallpaper_current_path == ""

- name: verify wallpaper path matches expected
  assert:
    that:
      - verify_wallpaper_current_path == macos_wallpaper_path
    fail_msg: >
      verify_wallpaper failed.
      Expected: {{ macos_wallpaper_path }}
      Got: {{ verify_wallpaper_current_path }}
    success_msg: "verify_wallpaper succeeded: wallpaper matches System Events"
