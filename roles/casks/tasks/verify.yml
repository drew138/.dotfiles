---
- name: verify Homebrew casks installation
  stat:
    path: "/Applications/{{ item.app }}.app"
  loop: "{{ casks }}"
  register: verify_cask_stats

- name: assert casks are present in /Applications
  assert:
    that:
      - item.stat.exists
    fail_msg: >
      cask {{ item.item.name }} was not found at /Applications/{{ item.item.app }}.app
  loop: "{{ verify_cask_stats.results }}"

- name: Check quarantine attribute on installed apps
  command: xattr -p com.apple.quarantine "/Applications/{{ item.app }}.app"
  loop: "{{ casks }}"
  register: quarantine_verify
  failed_when: false
  changed_when: false

- name: assert casks are not quarantined
  assert:
    that:
      - item.rc != 0
    fail_msg: >
      Cask {{ item.item.name }} ({{ item.item.app }}) is still quarantined
  loop: "{{ quarantine_verify.results }}"
